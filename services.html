<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CANVAS — Service Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">

  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    /* --- CORE VARIABLES --- */
    :root {
      --bg-body: #ffffff;
      --text-main: #111111;
      --accent: #3b82f6; /* Cobalt Blue */
      --surface: #f3f4f6;
      --border: #111111;
      --font-display: 'Space Grotesk', sans-serif;
      --font-body: 'Inter', sans-serif;
      --radius: 16px; 
    }

    /* --- RESET --- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg-body); color: var(--text-main);
      font-family: var(--font-body); line-height: 1.5;
      overflow-x: hidden;
    }

    /* --- TYPOGRAPHY --- */
    h1, h2, h3 { font-family: var(--font-display); line-height: 1.1; letter-spacing: -0.03em; }
    h1 { font-size: clamp(48px, 8vw, 80px); font-weight: 700; margin-bottom: 24px; }
    h2 { font-size: 32px; font-weight: 700; margin-bottom: 20px; }
    
    .label {
      font-family: var(--font-display); font-weight: 700; font-size: 14px; 
      text-transform: uppercase; letter-spacing: 0.1em; color: var(--accent);
      display: inline-block; border: 2px solid var(--accent); padding: 8px 16px;
      border-radius: 50px; margin-bottom: 24px; background: white;
    }

    /* --- UTILITIES --- */
    .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
    .section-pad { padding: 80px 0; }
    
    .btn {
      display: inline-block; background: var(--accent); color: white;
      padding: 10px 24px; border-radius: 12px; font-family: var(--font-display);
      font-weight: 700; font-size: 14px; text-decoration: none;
      transition: 0.2s; border: 2px solid var(--accent);
      box-shadow: 4px 4px 0px var(--text-main); cursor: pointer;
    }
    .btn:hover { transform: translate(-2px, -2px); box-shadow: 6px 6px 0px var(--text-main); }
    
    .btn-outline {
      background: white; color: var(--text-main); border: 2px solid var(--text-main);
      padding: 12px 24px; border-radius: 12px; font-family: var(--font-display);
      font-weight: 700; font-size: 16px; text-decoration: none;
      box-shadow: 4px 4px 0px var(--text-main);
    }

    /* --- NAVIGATION --- */
    nav {
      padding: 24px; display: flex; justify-content: space-between; align-items: center;
      position: sticky; top: 0; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); z-index: 50;
      border-bottom: 2px solid var(--text-main);
    }
    .logo { 
      font-family: var(--font-display); font-size: 28px; font-weight: 700; 
      letter-spacing: -0.05em; display: flex; align-items: center; gap: 8px;
    }
    .color-dot { width: 12px; height: 12px; background: var(--accent); border-radius: 50%; border: 2px solid var(--text-main); }
    .nav-links { display: flex; gap: 32px; }
    .nav-links a { color: var(--text-main); text-decoration: none; font-weight: 600; font-family: var(--font-display); }
    @media(max-width: 768px) { .nav-links { display: none; } }

    /* --- MENU HEADER --- */
    .menu-header {
      padding: 80px 0; border-bottom: 2px solid var(--text-main); margin-bottom: 60px;
    }
    
    .explainer-box {
      background: var(--surface); padding: 30px; border-radius: var(--radius);
      border: 2px solid var(--text-main); margin-top: 40px;
      display: flex; gap: 20px; align-items: flex-start;
    }
    .info-icon {
      min-width: 40px; height: 40px; background: var(--accent); color: white;
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      border: 2px solid var(--text-main);
    }

    /* --- MENU GRID --- */
    .menu-section { margin-bottom: 80px; }
    .section-head { 
      display: flex; justify-content: space-between; align-items: flex-end; 
      margin-bottom: 40px; border-bottom: 2px solid #e5e5e5; padding-bottom: 20px;
    }
    .sec-title { font-size: 32px; font-weight: 700; font-family: var(--font-display); }

    .service-row {
      display: grid; grid-template-columns: 2fr 1fr 150px; gap: 20px; align-items: center;
      padding: 24px; border: 2px solid transparent; border-radius: 12px;
      margin-bottom: 12px; transition: 0.2s;
    }
    .service-row:hover {
      border-color: var(--text-main); background: white; box-shadow: 4px 4px 0px rgba(0,0,0,0.1);
    }
    .service-row:nth-child(even) { background: #fafafa; }
    .service-row:nth-child(even):hover { background: white; }

    .svc-info h4 { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
    .svc-desc { font-size: 14px; color: #666; }
    
    .svc-price { font-family: var(--font-display); font-weight: 700; font-size: 20px; color: var(--accent); }

    @media(max-width: 768px) {
      .service-row { grid-template-columns: 1fr; gap: 16px; padding: 20px; border: 2px solid #eee; }
      .svc-price { margin-bottom: 10px; display: block; }
      .section-head { flex-direction: column; align-items: flex-start; gap: 10px; }
    }

    /* --- FOOTER --- */
    footer { padding: 60px 24px; text-align: center; background: #111; color: white; margin-top: 80px; }

  </style>
</head>
<body>

  <nav>
    <div class="logo" id="nsLogo">
      <div class="color-dot"></div>
      CANVAS.
    </div>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="about.html">Philosophy</a>
      <a href="services.html" class="active">Services</a>
      <a href="team.html">Artists</a>
    </div>
    <button type="button" class="btn" id="nsBookNowBtn" style="padding: 10px 24px; font-size: 16px;">
      Book Now
    </button>
  </nav>

  <header class="container menu-header">
    <div class="label">The Menu</div>
    <h1>Transparent Pricing.</h1>
    
    <div class="explainer-box">
      <div class="info-icon"><i data-lucide="clock"></i></div>
      <div>
        <h4 style="font-weight: 700; margin-bottom: 8px;">How Hourly Pricing Works</h4>
        <p style="font-size: 15px; color: #555;">
          We charge by the time booked, not by gender. Gratuity is already included in the price. 
          If you have extra thick hair or want a major change, please book the "Transformation" block.
        </p>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="nsMenuMount"></div>
  </main>

  <footer>
    <div id="nsFooterTitle" style="font-family: var(--font-display); font-size: 32px; font-weight: 700; margin-bottom: 20px;">
      CANVAS.
    </div>
    <p style="color: #888; font-size: 14px;">© 2026 Canvas Studio. A Safe Space for All.</p>
  </footer>

  <script>
    lucide.createIcons();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // 1. Slug Helper
    function nsGetSlugFromHost() {
      const qp = new URLSearchParams(location.search).get("b");
      if (qp) return String(qp).trim().toLowerCase();

      const host = (location.hostname || "").toLowerCase();
      if (!host || host === "localhost" || host.startsWith("127.")) return null;

      const ROOT = "netstudiodevelopment.com";
      if (host === ROOT || host === "www." + ROOT) return null;

      if (host.endsWith("." + ROOT)) {
        const slug = host.slice(0, -(ROOT.length + 1)).split(".")[0];
        return slug || null;
      }
      return null;
    }

    // 2. Supabase Config
    window.NS = {
      ...(window.NS || {}),
      SUPABASE_URL: "https://jdvdgvolfmvlgyfklbwe.supabase.co",
      SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdmRndm9sZm12bGd5ZmtsYndlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1Mjk5MDgsImV4cCI6MjA3OTEwNTkwOH0.xiAOgWof9En3jbCpY1vrYpj3HD-O6jMHbamIHTSflek",
      BUSINESS_SLUG: nsGetSlugFromHost()
    };

    const sb = window.supabaseClient || window.supabase.createClient(window.NS.SUPABASE_URL, window.NS.SUPABASE_ANON_KEY);
    window.supabaseClient = sb;

    // 3. Load Business + Branding
    async function nsLoadBusiness() {
      if (!window.NS.BUSINESS_SLUG) return null;

      const { data, error } = await sb
        .from("business")
        .select("id,name,logo_url")
        .eq("slug", window.NS.BUSINESS_SLUG)
        .maybeSingle();

      if (error || !data) return null;

      window.BUSINESS_ID = data.id;
      // Critical: DOM hook for booking engine
      document.body.dataset.businessId = data.id;

      return data;
    }

    function nsApplyBranding(biz) {
      if (!biz) return;
      const name = (biz.name || "CANVAS").trim();
      const logo = biz.logo_url;
      const logoEl = document.getElementById("nsLogo");
      const footerEl = document.getElementById("nsFooterTitle");

      if (logoEl) {
        logoEl.innerHTML = logo
          ? `<img src="${logo}" alt="${name}" style="height:28px; max-width:260px; object-fit:contain;">`
          : `<div class="color-dot"></div>${name.toUpperCase()}.`;
      }
      if (footerEl) footerEl.textContent = `${name.toUpperCase()}.`;
    }

    // 4. Menu Logic
    async function nsLoadMenuItems() {
      if (!window.BUSINESS_ID) return [];
      const { data, error } = await sb
        .from("menu_items")
        .select("id,section,name,description,price,price_cents,is_active")
        .eq("business_id", window.BUSINESS_ID)
        .eq("is_active", true)
        .order("section", { ascending: true })
        .order("name", { ascending: true });

      if (error) return [];
      return data || [];
    }

    function nsMoney(row) {
      if (typeof row.price_cents === "number") return `$${(row.price_cents / 100).toFixed(2)}`;
      if (row.price != null && row.price !== "") return String(row.price);
      return "";
    }

    function nsRenderMenu(items) {
      const mount = document.getElementById("nsMenuMount");
      if (!mount) return;

      if (!items.length) {
        mount.innerHTML = `<div style="padding:40px 0;">No services found.</div>`;
        return;
      }

      const groups = {};
      items.forEach(i => {
        const sec = (i.section || "Services").trim();
        (groups[sec] ||= []).push(i);
      });

      mount.innerHTML = "";

      Object.entries(groups).forEach(([section, rows]) => {
        const wrap = document.createElement("div");
        wrap.className = "menu-section";
        wrap.innerHTML = `
          <div class="section-head">
            <h3 class="sec-title">${section}</h3>
          </div>
          ${rows.map(r => `
            <div class="service-row">
              <div class="svc-info">
                <h4>${r.name || ""}</h4>
                <div class="svc-desc">${r.description || ""}</div>
              </div>
              <div class="svc-price">${nsMoney(r)}</div>
              <button type="button" class="btn" onclick="window.openBooking && window.openBooking('${r.id}')">Book</button>
            </div>
          `).join("")}
        `;
        mount.appendChild(wrap);
      });
    }

    // 5. Dynamic Engine Loader (The Fix)
    function nsLoadBookingScript() {
      // ✅ Correct Path: "./netstudio_booking.js" for Canvas flat structure
      if (document.querySelector('script[data-ns-booking="1"]')) return;
      const s = document.createElement("script");
      s.src = "./netstudio_booking.js"; 
      s.defer = true;
      s.dataset.nsBooking = "1";
      document.body.appendChild(s);
    }

    // 6. Bridge & Wire
    window.openBooking = window.openBooking || function(serviceId){
      // Safety bridge: if engine loaded & exposes NetStudio, use it
      if (window.NetStudio && typeof window.NetStudio.open === "function") {
        return window.NetStudio.open(serviceId);
      }
      console.warn("Booking engine loading...");
    };

    function nsWireBookNow() {
      const topBtn = document.getElementById("nsBookNowBtn");
      if (!topBtn) return;
      // Robust retry click handler
      topBtn.addEventListener("click", async () => {
        const start = Date.now();
        while (Date.now() - start < 1500) {
          if (window.NetStudio) break; // Engine loaded
          await new Promise(r => setTimeout(r, 50));
        }
        window.openBooking && window.openBooking();
      });
    }

    // 7. Init
    (async () => {
      const biz = await nsLoadBusiness();
      if (!biz) return;

      nsApplyBranding(biz);
      nsWireBookNow();

      const items = await nsLoadMenuItems();
      nsRenderMenu(items);
      
      // ✅ Load Engine Last (with correct path)
      nsLoadBookingScript();
    })();
  </script>
</body>
</html>
